---
title: Environment Records
excerpt: Environment Records
date: 2024-01-23
type: Docs
category: ControlObjects
tags: Environment Records
---

**Environment Record** 是一种用于定义标识符(*Identify*)与特定变量和函数之间关联的规范类型，基于ECMAScript代码的词法嵌套结构。通常，
环境记录与代码的某些特定语法相关联，例如函数声明*FunctionDeclaration*，块语句*BlockStatement*或者捕获子语句*TryStatement*。
每次在执行此类代码之前（解释时），**都会创建一个新的环境记录来记录该代码创建的标识符绑定**。

每个环境记录都有一个`[[OuterEnv]]`字段（为空或者对外部环境记录的引用）。这用于模拟环境记录值的逻辑嵌套。一个（内部）环境记录的外部引用是对逻辑
包围内部环境记录的引用。外部环境记录也有自己的外部环境记录，环境记录可以作为多个内部环境记录的外部环境。

举个例子，一个*FunctionDeclaration*包含了两个嵌套的`FunctionDeclaration`，那么每个嵌套函数的外部环境记录将是**周围函数当前评估的环境记录**。

<Pitfall>
  注意，环境记录纯粹是规范机制，不需要对其实现，程序也不能直接访问和操作其值
</Pitfall>

## 环境记录的层次结构

环境记录可以被认为是存在于一个简单的面向对象的层次结构中，其中环境记录是一个抽象类，有三个具体的子类：
- 声明式环境记录：用于定义ECMAScript语言语法元素的效果，如函数声明，变量声明和*Catch子句*，它们将标识符绑定与ECMAScript语言值相关联。
  - 函数环境记录：对应于函数对象的调用，并包含该函数中顶层声明的绑定，它还可以建立一个新的`this`绑定，还可以捕获支持`super`方法调用的必要状态。
  - 模块环境记录：包含模块顶层声明的绑定，它还包含模块显示导入的绑定，它的`[[OuterEnv]]`是一个全局环境记录。
- 对象环境记录：用于定义ECMAScript元素的效果，如将标识符绑定与某个对象的属性相关联的*WithStatement*。
- 全局环境记录：用于脚本全局声明，它没有外部环境，所以`[[OuterEnv]]`为空，它可以预先填充标识符绑定，并且包括相关联的全局对象，其属性提供全局环境的一些
标识符绑定。当代码被执行时，可以向全局对象添加额外的属性，并且可以修改初始属性。

环境记录抽象类包含了下表定义的规范方法，这些抽象方法对每一个子类都有不同的具体算法。

### 声明式环境记录

每个声明式环境记录都与包含`var`、`const`、`let`、`class`、`module`、`import`和function声明的程序范围相关联。